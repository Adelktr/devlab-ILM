<template>
  <div ref="mapElement" class="map-container"></div>
</template>

<script setup>
import { onMounted, ref } from "vue";
import "ol/ol.css";
import Map from "ol/Map";
import View from "ol/View";
import TileLayer from "ol/layer/Tile";
import OSM from "ol/source/OSM";
import { fromLonLat } from "ol/proj";
import { Feature } from "ol";
import { Polygon } from "ol/geom";
import VectorLayer from "ol/layer/Vector";
import VectorSource from "ol/source/Vector";
import { Style, Stroke, Fill } from "ol/style";

const mapElement = ref(null);

onMounted(() => {
  const geoShape = {
    geometry: {
      coordinates: [
        [
          [2.280831740517167, 48.819670703189885],
          [2.2794544218278157, 48.818810149441575],
          [2.278945470062797, 48.81861194989743],
          [2.2780955293008054, 48.81816708004425],
          [2.277344646861012, 48.8176361506372],
          [2.277095300883511, 48.81742761449838],
          [2.2769408636445716, 48.81739098531198],
          [2.275984593572217, 48.81723051991497],
          [2.2758587181449097, 48.81721309968539],
          [2.2746316177837573, 48.81632485767679],
          [2.2732771693975447, 48.815255646011565],
          [2.273006146834819, 48.81507067324698],
          [2.2728335787084304, 48.81483622906331],
          [2.2727229481677567, 48.81468592978805],
          [2.272676441975786, 48.81462274883253],
          [2.2725953689293945, 48.81463888057868],
          [2.2724221685273167, 48.814694082987224],
          [2.272279885974526, 48.814739498299275],
          [2.27228758995725, 48.8147528570783],
          [2.272297780773312, 48.81476874389467],
          [2.2723529240411477, 48.81485470875182],
          [2.272711550431521, 48.81496521976941],
          [2.272900729496435, 48.81504204379076],
          [2.2728012747794724, 48.8150982188594],
          [2.2726355788783144, 48.81515229982089],
          [2.272719902627187, 48.815262822722794],
          [2.2727431651558083, 48.81525505596748],
          [2.272768892706219, 48.81524640481957],
          [2.272808852577131, 48.815232898130866],
          [2.272837072756743, 48.81526824136295],
          [2.272850445944653, 48.81528514311195],
          [2.2728989945238016, 48.81534606632781],
          [2.272965290897193, 48.81544145595306],
          [2.273016503103654, 48.815515886149385],
          [2.273080115528019, 48.81560865023995],
          [2.2731345258089775, 48.81568795652567],
          [2.2732373691577648, 48.81577989065641],
          [2.2732611032715715, 48.8157678096057],
          [2.2733545808034337, 48.815848262636415],
          [2.27338765337046, 48.81587779009509],
          [2.2734277164749654, 48.81591356762567],
          [2.2734064522897337, 48.8159243146429],
          [2.2734435962689106, 48.81595476802578],
          [2.273477780918676, 48.81598268331827],
          [2.2734451074358852, 48.816000823203545],
          [2.2735191119730085, 48.81606253675497],
          [2.2735051177631824, 48.81606964318985],
          [2.2735779183150324, 48.816129909460194],
          [2.273592322202876, 48.81612262562973],
          [2.273706797906265, 48.81622020802653],
          [2.27373746871764, 48.81624630310444],
          [2.273797977987264, 48.816214939510274],
          [2.2741083433180416, 48.816054389337694],
          [2.274126628415555, 48.81606891580105],
          [2.2742550917922832, 48.81617097164956],
          [2.2742084469634403, 48.81619468943852],
          [2.2741118650627445, 48.81624372296253],
          [2.2739379124228605, 48.81633183874452],
          [2.273864378368103, 48.81636914646696],
          [2.2739312344730256, 48.81642613678604],
          [2.2739892137451694, 48.816475517377064],
          [2.274246429321925, 48.81634592918346],
          [2.274287036104984, 48.8163254107132],
          [2.274335460068895, 48.816301074127786],
          [2.2743633083282777, 48.81628704099133],
          [2.2743869037321924, 48.816275138758066],
          [2.274563167544567, 48.816411722385595],
          [2.2747323330555123, 48.81654280516715],
          [2.274782820296257, 48.816582874400865],
          [2.2750207867803582, 48.81676712244205],
          [2.27512385022574, 48.81684430621393],
          [2.2750852558915793, 48.81686690665776],
          [2.2750815452402304, 48.816869220757766],
          [2.2750000999554314, 48.8169169122675],
          [2.2749139817553434, 48.816967450709804],
          [2.2750034257613128, 48.81703528644502],
          [2.275095429772998, 48.81710502545114],
          [2.2748187780386635, 48.81726947822108],
          [2.274834936098386, 48.817282171290216],
          [2.274872771544875, 48.81731199790897],
          [2.2749196016689317, 48.81733198942705],
          [2.2750559147443195, 48.81738896785189],
          [2.275112639556239, 48.81741216896908],
          [2.275157715915403, 48.81743106958935],
          [2.2751808568470344, 48.81744119853878],
          [2.2752530132837188, 48.81747088242809],
          [2.275256125274836, 48.817472251280954],
          [2.27532678508799, 48.8175018352101],
          [2.2753661772006892, 48.81751827203604],
          [2.2756265829117677, 48.81733770777454],
          [2.27565739769635, 48.81731631735503],
          [2.2757505264029425, 48.8172517922384],
          [2.275842270671724, 48.817320720526396],
          [2.275788939833992, 48.81735473954778],
          [2.2757519670747897, 48.81737824851168],
          [2.2756525952732924, 48.817441295863965],
          [2.2755038788311577, 48.81753577796389],
          [2.275469221991163, 48.81755912189999],
          [2.2754784256805474, 48.81756304776153],
          [2.2755416461147373, 48.81758916698809],
          [2.2756548131628787, 48.8176364663956],
          [2.2756766137305924, 48.81764505816435],
          [2.2758255223734976, 48.817716325039484],
          [2.2758646073633058, 48.8177351872805],
          [2.2759053190325647, 48.81775459989598],
          [2.2760098660028314, 48.81780463302737],
          [2.2760411103852243, 48.817819488607874],
          [2.2760688353344602, 48.81783279390283],
          [2.276131186742838, 48.81786259502962],
          [2.2761413286977326, 48.817867515847226],
          [2.2761871790839727, 48.8178894786711],
          [2.276259537685812, 48.81792410888704],
          [2.276172804145794, 48.81797950205373],
          [2.2762370297377443, 48.818011562938295],
          [2.276334918556815, 48.8180606542609],
          [2.2763618228914493, 48.81807422343149],
          [2.276406845117974, 48.81809690066027],
          [2.276505816215764, 48.818146538022575],
          [2.2765440784347515, 48.81816584564305],
          [2.2765823431908934, 48.818184972489476],
          [2.27666968317467, 48.81822896040898],
          [2.2767581091270057, 48.81827331458893],
          [2.276904942027726, 48.818347085783394],
          [2.2769597924579186, 48.81831163736789],
          [2.276989900053391, 48.8182920411172],
          [2.2770764247190667, 48.81833593386157],
          [2.2770988668214573, 48.81834740638047],
          [2.277187826715724, 48.818392483873374],
          [2.2772316314361194, 48.818414612887175],
          [2.277244600141443, 48.81840309283588],
          [2.2773465219882985, 48.81832212227553],
          [2.277684180972674, 48.818600835463286],
          [2.2776124297325473, 48.81864930768061],
          [2.277589123385468, 48.818697815483375],
          [2.2775690467522516, 48.81873959830882],
          [2.277502643191215, 48.818877409097055],
          [2.2774870579847013, 48.81890986724289],
          [2.2773768342497194, 48.819139854563154],
          [2.2773560763573104, 48.81918163321887],
          [2.277242922632581, 48.81916140619797],
          [2.2771375127282036, 48.81914257678622],
          [2.276913789576472, 48.81910249671106],
          [2.2767461647590364, 48.819072573423995],
          [2.2766440135166013, 48.81905439286502],
          [2.276608708225597, 48.81902550674774],
          [2.2764439118714637, 48.819180473383774],
          [2.276487927582418, 48.81919694499601],
          [2.2766562382540214, 48.81923595658614],
          [2.2768231960724163, 48.81927433018046],
          [2.2778022843663077, 48.8194991181038],
          [2.2780317252800466, 48.8193693461458],
          [2.278085246680051, 48.81933164075226],
          [2.2782129501239203, 48.8192399004186],
          [2.278307348443741, 48.81917232407577],
          [2.278400309776345, 48.81912992357238],
          [2.278948591161515, 48.81956793726767],
          [2.2788693394088946, 48.81967025879561],
          [2.278700032285763, 48.82003046511798],
          [2.278542133496486, 48.82024111205652],
          [2.2785846748228957, 48.820256960592964],
          [2.278608808440508, 48.82026448662112],
          [2.2786744338550116, 48.820284774420976],
          [2.2789469585199984, 48.82036949332668],
          [2.279069933658902, 48.8204077674315],
          [2.279320753498987, 48.82048668481794],
          [2.2794103770267182, 48.82051440642907],
          [2.2794404681669453, 48.820524398343586],
          [2.279457279143631, 48.82052971972627],
          [2.2794716513034463, 48.820534216957135],
          [2.2795093414759533, 48.820546144274516],
          [2.2795360503583106, 48.82055449598288],
          [2.279562082172917, 48.820562662827484],
          [2.2796088556484273, 48.82057743565804],
          [2.279647631641778, 48.82058964019085],
          [2.279701184580225, 48.82060652333084],
          [2.2797667057314714, 48.820624561432],
          [2.2798024881682926, 48.82063656709684],
          [2.279825666339519, 48.82064426699425],
          [2.2798453199251876, 48.820650865488204],
          [2.2798704059783215, 48.82065848693497],
          [2.279932909896396, 48.82067794487809],
          [2.2798782469320353, 48.820766726494355],
          [2.2799589340211877, 48.820790885339186],
          [2.2800377233804863, 48.8208144921666],
          [2.280203845885481, 48.820864187256554],
          [2.2802293406583654, 48.820871811087414],
          [2.2802129279112267, 48.82089563045598],
          [2.280195541839277, 48.82092079303551],
          [2.2801773175060878, 48.82094747951586],
          [2.2802971887887495, 48.820983933966055],
          [2.2804283164329213, 48.821023696548195],
          [2.280392921175845, 48.82107950424984],
          [2.2803890195184082, 48.821085684706475],
          [2.2803863708630905, 48.82108989496266],
          [2.280340525988779, 48.82116209485045],
          [2.2803370452908633, 48.82116737935551],
          [2.280316141245167, 48.82120052347876],
          [2.280299031303171, 48.82122412999708],
          [2.2806220909163786, 48.82131656560403],
          [2.2809796591497182, 48.82141485337336],
          [2.2809368460831267, 48.82149272163318],
          [2.281009176985317, 48.82150802990245],
          [2.2810788128200126, 48.8215242042107],
          [2.281132022115671, 48.82153667764328],
          [2.2811309027054842, 48.82153873949177],
          [2.2812168152699877, 48.82155951213638],
          [2.281335707416162, 48.8215884048067],
          [2.281307710640886, 48.82164129107119],
          [2.2812905076979892, 48.82167275057591],
          [2.281270930992323, 48.821708241227775],
          [2.281246455780431, 48.82175296516332],
          [2.2812348495524004, 48.82177393733158],
          [2.2812100956962063, 48.821819109273186],
          [2.281195275084299, 48.82184590719505],
          [2.2811811464647884, 48.82187180899409],
          [2.281156113931867, 48.82191742893643],
          [2.281196971345686, 48.82192694821513],
          [2.2812818038637594, 48.82194717377762],
          [2.2813435711963086, 48.821961230223415],
          [2.2814096768260517, 48.82197675263372],
          [2.281527635288977, 48.82200429040905],
          [2.281568193978083, 48.82193025868226],
          [2.281635748578592, 48.821806662314984],
          [2.2816891771246475, 48.82170887873541],
          [2.2817814582873006, 48.82154190792027],
          [2.281839132297015, 48.82143290927316],
          [2.281843890844619, 48.82142403577078],
          [2.2818571893739334, 48.82139893744306],
          [2.2818850405980258, 48.821346679735726],
          [2.281890499902096, 48.82133637142797],
          [2.281912755576951, 48.82129442120114],
          [2.2818794025321174, 48.821283960628406],
          [2.281848904437198, 48.82127447594452],
          [2.2817439473060404, 48.821241834350445],
          [2.2817176450453873, 48.82123357552599],
          [2.281681579463398, 48.821222288249835],
          [2.281586124675809, 48.8211925528747],
          [2.28153568663295, 48.82117676857966],
          [2.281415149335749, 48.82113923211878],
          [2.281378676557945, 48.821127852362984],
          [2.2813469516712708, 48.82111776118264],
          [2.28137293337593, 48.821072506631545],
          [2.2815224071368, 48.820811194474665],
          [2.2817573679574727, 48.82040058545371],
          [2.281825813707051, 48.820281131346825],
          [2.2818672245352385, 48.8202286528846],
          [2.281447740869248, 48.82007383511985],
          [2.280831740517167, 48.819670703189885],
        ],
      ],
      type: "Polygon",
    },
  };

  // Transformer les coordonnées en format EPSG:3857
  const transformedCoordinates = geoShape.geometry.coordinates[0].map((coord) =>
    fromLonLat(coord)
  );

  // Créer le feature Polygon
  const polygonFeature = new Feature({
    geometry: new Polygon([transformedCoordinates]),
  });

  // Style pour le Polygon
  polygonFeature.setStyle(
    new Style({
      stroke: new Stroke({
        color: "blue",
        width: 3,
      }),
      fill: new Fill({
        color: "rgba(0, 0, 255, 0.1)",
      }),
    })
  );

  // Créer une couche vectorielle pour le Polygon
  const vectorLayer = new VectorLayer({
    source: new VectorSource({
      features: [polygonFeature],
    }),
  });

  // Initialiser la carte
  const map = new Map({
    target: mapElement.value,
    layers: [
      new TileLayer({
        source: new OSM(),
      }),
      vectorLayer,
    ],
    view: new View({
      center: fromLonLat([2.2783981176581207, 48.81899371048806]),
      zoom: 13,
    }),
  });
});
</script>

<style>
.map-container {
  height: 400px;
  width: 100%;
}
</style>
